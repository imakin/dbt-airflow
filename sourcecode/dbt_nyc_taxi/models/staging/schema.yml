version: 2
models:
  - name: stg_taxi_trips
    description: "Staging table untuk NYC (Yellow) taxi trips data"

    # referensi info https://www.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf
    columns:
      - name: trip_id
        description: "Unique key generated from MD5 hash of natural key columns (vendorid, pickup_datetime, dropoff_datetime, pickup_location_id, dropoff_location_id)"
        tests:
          - unique
          - not_null
      
      - name: vendor_id
        description: "Taxi vendor identifier. 1 = Creative Mobile Technologies, 2 = VeriFone Inc."
        tests:
          - not_null
          - accepted_values:
              values: [1, 2]
      
      - name: pickup_datetime
        description: "Date and time when the taxi meter was engaged"
        tests:
          - not_null
      
      - name: dropoff_datetime
        description: "Date and time when the taxi meter was disengaged"
        tests:
          - not_null
      
      - name: passenger_count
        description: "Number of passengers in the vehicle (driver-entered value)"
        tests:
          - not_null
      
      - name: trip_distance
        description: "Elapsed trip distance in miles reported by the taximeter"
        tests:
          - not_null
      
      - name: rate_code_id
        description: "Final rate code in effect at trip end. 1=Standard, 2=JFK, 3=Newark, 4=Nassau/Westchester, 5=Negotiated fare, 6=Group ride, 99=Null/Unknown"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 99]
      
      - name: store_and_fwd_flag
        description: "Flag indicating whether trip record was held in vehicle memory before sending to vendor (Y=store and forward, N=not a store and forward trip)"
        tests:
          - accepted_values:
              values: ['Y', 'N']
      
      - name: pickup_location_id
        description: "TLC Taxi Zone where the meter was engaged"
        tests:
          - not_null
          - relationships:
              to: ref('staging_taxi_zones')
              field: location_id
      
      - name: dropoff_location_id
        description: "TLC Taxi Zone where the meter was disengaged"
        tests:
          - not_null
          - relationships:
              to: ref('staging_taxi_zones')
              field: location_id
      
      - name: payment_type
        description: "Payment method. 0=Flex Fare Trip, 1=Credit card, 2=Cash, 3=No charge, 4=Dispute, 5=Unknown, 6=Voided trip"
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4, 5, 6]
      
      - name: fare_amount
        description: "Time-and-distance fare calculated by the meter"
        tests:
          - not_null
      
      - name: extra
        description: "Miscellaneous extras and surcharges (e.g., rush hour, overnight charges)"
      
      - name: mta_tax
        description: "MTA tax automatically triggered based on metered rate in use ($0.50)"
      
      - name: tip_amount
        description: "Tip amount. Automatically populated for credit card tips; cash tips are not included"
      
      - name: tolls_amount
        description: "Total amount of all tolls paid during the trip"
      
      - name: improvement_surcharge
        description: "Improvement surcharge assessed on hailed trips ($0.30)"
      
      - name: total_amount
        description: "Total amount charged to passengers (does not include cash tips)"
        tests:
          - not_null
      
      - name: congestion_surcharge
        description: "Congestion surcharge for trips in Manhattan south of 96th Street ($2.50 for non-shared rides)"
      
      - name: airport_fee
        description: "Airport fee for pickups at LaGuardia and JFK airports ($1.25)"

      

  
  - name: stg_taxi_zones
    description: "Staging table for taxi zone lookup data"
    columns:
      - name: location_id
        tests:
          - unique
          - not_null
        description: "Identifier for each taxi zone"

      - name: borough
        description: "NYC borough where the zone is located (Manhattan, Brooklyn, Queens, Bronx, Staten Island, EWR)"
        tests:
          - not_null

      - name: zone
        description: "Name of the taxi zone or area"
        tests:
          - not_null
      
      - name: service_zone
        description: "Service zone classification"
